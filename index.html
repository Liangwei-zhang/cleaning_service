<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ğŸ  çŸ­ç§Ÿæ¸…æ½”ç®¡ç†</title>
    <style>$(cat /tmp/optimized.css)</style>
</head>
<body>
    <div class="login-screen">
        <div class="login-box">
            <div class="login-logo">ğŸ </div>
            <div class="login-title">çŸ­ç§Ÿæ¸…æ½”ç®¡ç†</div>
            <button class="role-btn" onclick="showHostLogin()">ğŸ  æˆ¿æ±ï¼ˆç™¼å–®ï¼‰</button>
            <button class="role-btn" onclick="showCleanerLogin()">ğŸ‘· æ¸…æ½”å·¥ï¼ˆæ¥å–®ï¼‰</button>
            <button class="role-btn" onclick="showAdminLogin()">ğŸ“Š èª¿åº¦å¹³å°ï¼ˆç®¡ç†ï¼‰</button>
        </div>
    </div>
    
    <div class="modal" id="modal-host">
        <div class="modal-content">
            <h2>ğŸ  æˆ¿æ±ç™»éŒ„</h2>
            <input type="text" id="host-code" placeholder="é©—è­‰ç¢¼" value="547047">
            <button class="btn btn-primary" onclick="loginHost()">ç™»éŒ„</button>
            <button class="btn" style="background:var(--bg-main);color:var(--text-p)" onclick="closeModal()">å–æ¶ˆ</button>
        </div>
    </div>
    
    <div class="modal" id="modal-cleaner">
        <div class="modal-content">
            <h2>ğŸ‘· æ¸…æ½”å·¥ç™»éŒ„</h2>
            <input type="text" id="cleaner-code" placeholder="é©—è­‰ç¢¼" value="733025">
            <button class="btn btn-primary" onclick="loginCleaner()">ç™»éŒ„</button>
            <button class="btn" style="background:var(--bg-main);color:var(--text-p)" onclick="closeModal()">å–æ¶ˆ</button>
        </div>
    </div>
    
    <div class="modal" id="modal-admin">
        <div class="modal-content">
            <h2>ğŸ“Š ç®¡ç†å“¡ç™»éŒ„</h2>
            <input type="text" id="admin-username" placeholder="ç”¨æˆ¶å" value="admin">
            <input type="password" id="admin-password" placeholder="å¯†ç¢¼" value="admin123">
            <button class="btn btn-primary" onclick="loginAdmin()">ç™»éŒ„</button>
            <button class="btn" style="background:var(--bg-main);color:var(--text-p)" onclick="closeModal()">å–æ¶ˆ</button>
        </div>
    </div>
    
    <div class="toast" id="toast"></div>
    
    <script>
        const API = 'http://127.0.0.1:80/api';
        
        function showToast(msg, type = 'success') {
            const toast = document.getElementById('toast');
            toast.textContent = msg;
            toast.style.background = type === 'success' ? 'var(--success)' : type === 'error' ? 'var(--danger)' : 'var(--text-h)';
            setTimeout(() => toast.classList.add('show'), 10);
            setTimeout(() => toast.classList.remove('show'), 2500);
            if (navigator.vibrate) navigator.vibrate(10);
        }
        
        function showHostLogin() { document.getElementById('modal-host').classList.add('active'); }
        function showCleanerLogin() { document.getElementById('modal-cleaner').classList.add('active'); }
        function showAdminLogin() { document.getElementById('modal-admin').classList.add('active'); }
        function closeModal() { document.querySelectorAll('.modal').forEach(m => m.classList.remove('active')); }
        
        async function loginHost() {
            const code = document.getElementById('host-code').value;
            if (!code) { showToast('è«‹è¼¸å…¥é©—è­‰ç¢¼', 'warn'); return; }
            const res = await fetch(API + '/hosts/code/' + code);
            const data = await res.json();
            if (res.ok && data.data) {
                localStorage.setItem('host_id', data.data.id);
                localStorage.setItem('host_phone', data.data.phone);
                location.href = 'host.html';
            } else { showToast('é©—è­‰ç¢¼éŒ¯èª¤', 'error'); }
        }
        
        async function loginCleaner() {
            const code = document.getElementById('cleaner-code').value;
            if (!code) { showToast('è«‹è¼¸å…¥é©—è­‰ç¢¼', 'warn'); return; }
            const res = await fetch(API + '/cleaners');
            const data = await res.json();
            const cleaner = data.data?.find(c => c.code === code);
            if (cleaner) {
                localStorage.setItem('cleaner_id', cleaner.id);
                localStorage.setItem('cleaner_code', cleaner.code);
                location.href = 'cleaner.html';
            } else { showToast('é©—è­‰ç¢¼éŒ¯èª¤', 'error'); }
        }
        
        async function loginAdmin() {
            const username = document.getElementById('admin-username').value;
            const password = document.getElementById('admin-password').value;
            if (username === 'admin' && password === 'admin123') {
                localStorage.setItem('admin_user', username);
                location.href = 'admin.html';
            } else { showToast('ç”¨æˆ¶åæˆ–å¯†ç¢¼éŒ¯èª¤', 'error'); }
        }
    </script>
</body>
</html>
