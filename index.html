<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ğŸ  çŸ­ç§Ÿæ¸…æ½”ç®¡ç†</title>
    <style>
        :root {
            --primary: #6366F1;
            --bg-main: #F8FAFC;
            --bg-card: #FFFFFF;
            --text-h: #0F172A;
            --text-p: #475569;
            --border: #E2E8F0;
            --success: #10B981;
            --danger: #EF4444;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: linear-gradient(135deg, #6366F1 0%, #4F46E5 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 24px;
        }
        .login-box {
            background: var(--bg-card);
            padding: 32px;
            border-radius: 20px;
            width: 100%;
            max-width: 360px;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
        }
        .login-logo { font-size: 56px; margin-bottom: 16px; }
        .login-title { font-size: 22px; font-weight: 700; color: var(--text-h); margin-bottom: 24px; }
        
        .role-btn {
            width: 100%;
            height: 56px;
            margin-bottom: 12px;
            border: 1px solid var(--border);
            border-radius: 12px;
            background: var(--bg-card);
            color: var(--text-h);
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.2s;
        }
        .role-btn:active { background: var(--bg-main); transform: scale(0.98); }
        
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 16px;
        }
        .modal.active { display: flex; }
        .modal-content {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 24px;
            width: 100%;
            max-width: 360px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
        }
        .modal-content h3 { font-size: 18px; font-weight: 600; color: var(--text-h); margin-bottom: 16px; }
        .modal-content input {
            width: 100%;
            height: 48px;
            padding: 0 16px;
            border: 1px solid var(--border);
            border-radius: 12px;
            font-size: 15px;
            margin-bottom: 12px;
            outline: none;
        }
        .modal-content input:focus { border-color: var(--primary); }
        
        .btn {
            width: 100%;
            height: 48px;
            border-radius: 12px;
            font-weight: 600;
            font-size: 15px;
            cursor: pointer;
            border: none;
            transition: all 0.2s;
        }
        .btn:active { transform: scale(0.96); }
        .btn-primary { background: var(--primary); color: #fff; box-shadow: 0 4px 12px rgba(99, 102, 241, 0.2); }
        .btn-cancel { background: var(--bg-main); color: var(--text-p); margin-top: 8px; }
        
        .toast {
            position: fixed;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%) translateY(20px);
            background: var(--text-h);
            color: #fff;
            padding: 12px 24px;
            border-radius: 12px;
            font-size: 14px;
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 2000;
        }
        .toast.show { transform: translateX(-50%) translateY(0); opacity: 1; }
    </style>
</head>
<body>
    <div class="login-box">
        <div class="login-logo">ğŸ </div>
        <div class="login-title">çŸ­ç§Ÿæ¸…æ½”ç®¡ç†</div>
        <button class="role-btn" onclick="showHostLogin()">ğŸ  æˆ¿æ±ï¼ˆç™¼å–®ï¼‰</button>
        <button class="role-btn" onclick="showCleanerLogin()">ğŸ‘· æ¸…æ½”å·¥ï¼ˆæ¥å–®ï¼‰</button>
        <button class="role-btn" onclick="showAdminLogin()">ğŸ“Š èª¿åº¦å¹³å°ï¼ˆç®¡ç†ï¼‰</button>
    </div>
    
    <!-- æˆ¿æ±ç™»éŒ„ -->
    <div class="modal" id="modal-host">
        <div class="modal-content">
            <h3>ğŸ  æˆ¿æ±ç™»éŒ„</h3>
            <input type="text" id="host-code" placeholder="é©—è­‰ç¢¼" value="547047">
            <button class="btn btn-primary" onclick="loginHost()">ç™»éŒ„</button>
            <button class="btn btn-cancel" onclick="closeModal()">å–æ¶ˆ</button>
        </div>
    </div>
    
    <!-- æ¸…æ½”å·¥ç™»éŒ„ -->
    <div class="modal" id="modal-cleaner">
        <div class="modal-content">
            <h3>ğŸ‘· æ¸…æ½”å·¥ç™»éŒ„</h3>
            <input type="text" id="cleaner-code" placeholder="é©—è­‰ç¢¼" value="733025">
            <button class="btn btn-primary" onclick="loginCleaner()">ç™»éŒ„</button>
            <button class="btn btn-cancel" onclick="closeModal()">å–æ¶ˆ</button>
        </div>
    </div>
    
    <!-- ç®¡ç†å“¡ç™»éŒ„ -->
    <div class="modal" id="modal-admin">
        <div class="modal-content">
            <h3>ğŸ“Š ç®¡ç†å“¡ç™»éŒ„</h3>
            <input type="text" id="admin-username" placeholder="ç”¨æˆ¶å" value="admin">
            <input type="password" id="admin-password" placeholder="å¯†ç¢¼" value="admin123">
            <button class="btn btn-primary" onclick="loginAdmin()">ç™»éŒ„</button>
            <button class="btn btn-cancel" onclick="closeModal()">å–æ¶ˆ</button>
        </div>
    </div>
    
    <div class="toast" id="toast"></div>
    
    <script>
        const API = 'http://127.0.0.1:80/api';
        
        function showToast(msg, type = 'success') {
            const toast = document.getElementById('toast');
            toast.textContent = msg;
            toast.style.background = type === 'success' ? 'var(--success)' : type === 'error' ? 'var(--danger)' : 'var(--text-h)';
            setTimeout(() => toast.classList.add('show'), 10);
            setTimeout(() => toast.classList.remove('show'), 2500);
        }
        
        function showHostLogin() { document.getElementById('modal-host').classList.add('active'); }
        function showCleanerLogin() { document.getElementById('modal-cleaner').classList.add('active'); }
        function showAdminLogin() { document.getElementById('modal-admin').classList.add('active'); }
        function closeModal() { 
            document.querySelectorAll('.modal').forEach(m => m.classList.remove('active'));
        }
        
        async function loginHost() {
            const code = document.getElementById('host-code').value;
            if (!code) { showToast('è«‹è¼¸å…¥é©—è­‰ç¢¼', 'warn'); return; }
            
            const res = await fetch(API + '/hosts/code/' + code);
            const data = await res.json();
            
            if (res.ok && data.data) {
                localStorage.setItem('host_id', data.data.id);
                localStorage.setItem('host_phone', data.data.phone);
                location.href = 'host.html';
            } else {
                showToast('é©—è­‰ç¢¼éŒ¯èª¤', 'error');
            }
        }
        
        async function loginCleaner() {
            const code = document.getElementById('cleaner-code').value;
            if (!code) { showToast('è«‹è¼¸å…¥é©—è­‰ç¢¼', 'warn'); return; }
            
            const res = await fetch(API + '/cleaners');
            const data = await res.json();
            const cleaner = data.data?.find(c => c.code === code);
            
            if (cleaner) {
                localStorage.setItem('cleaner_id', cleaner.id);
                localStorage.setItem('cleaner_code', cleaner.code);
                location.href = 'cleaner.html';
            } else {
                showToast('é©—è­‰ç¢¼éŒ¯èª¤', 'error');
            }
        }
        
        async function loginAdmin() {
            const username = document.getElementById('admin-username').value;
            const password = document.getElementById('admin-password').value;
            
            if (username === 'admin' && password === 'admin123') {
                localStorage.setItem('admin_user', username);
                location.href = 'admin.html';
            } else {
                showToast('ç”¨æˆ¶åæˆ–å¯†ç¢¼éŒ¯èª¤', 'error');
            }
        }
    </script>
</body>
</html>
