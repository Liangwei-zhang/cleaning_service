<!doctype html>
<html lang="zh-TW">
    <head>
        <meta charset="UTF-8" />
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"
        />
        <meta name="theme-color" content="#FAFBFF" />
        <title>ğŸ‘· æ¥å–®å“¡æ§åˆ¶å° - SmartClean</title>
        <style>
            /* --- 2026 æ¥µè‡´è¦–è¦ºé‡æ§‹ --- */
            /* åŠ è¼‰é®ç½© */
            .loading-overlay {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                backdrop-filter: blur(4px);
                -webkit-backdrop-filter: blur(4px);
                z-index: 9999;
                justify-content: center;
                align-items: center;
                flex-direction: column;
            }
            .loading-overlay.active {
                display: flex;
            }
            body.no-scroll {
                overflow: hidden !important;
            }
            .loading-spinner {
                width: 48px;
                height: 48px;
                border: 4px solid rgba(255, 255, 255, 0.3);
                border-top-color: #fff;
                border-radius: 50%;
                animation: spin 1s linear infinite;
            }
            @keyframes spin {
                to { transform: rotate(360deg); }
            }
            .loading-text {
                color: #fff;
                margin-top: 16px;
                font-size: 16px;
                font-weight: 600;
            }

            :root {
                --primary: oklch(60% 0.18 255); /* æ•¸ä½ç§‘æŠ€è— */
                --midnight: oklch(15% 0.02 250);
                --bg-canvas: oklch(98.5% 0.005 240);
                --text-main: oklch(10% 0.01 240);
                --text-muted: oklch(45% 0.02 240);
                --accent-gold: oklch(70% 0.12 85);

                /* 2026 ç»ç’ƒé«”ç³» */
                --glass-white: rgba(255, 255, 255, 0.88);
                --glass-border: rgba(255, 255, 255, 0.5);
                --shadow-premium: 0 20px 40px -12px oklch(0% 0 0 / 12%);
                --spring: cubic-bezier(0.34, 1.56, 0.64, 1);
            }

            body {
                background: var(--bg-canvas);
                font-family:
                    "Inter",
                    -apple-system,
                    system-ui,
                    sans-serif;
                color: var(--text-main);
                padding-bottom: calc(100px + env(safe-area-inset-bottom));
                background-image:
                    radial-gradient(
                        circle at 0% 0%,
                        oklch(85% 0.08 250 / 25%),
                        transparent 45%
                    ),
                    radial-gradient(
                        circle at 100% 100%,
                        oklch(85% 0.12 320 / 20%),
                        transparent 45%
                    );
                background-attachment: fixed;
                margin: 0;
                -webkit-font-smoothing: antialiased;
            }

            /* ç»ç’ƒæ…‹é ‚éƒ¨å°èˆª */
            header {
                position: sticky;
                top: 0;
                z-index: 1000;
                padding: calc(env(safe-area-inset-top) + 16px) 20px 16px;
                background: rgba(255, 255, 255, 0.65);
                backdrop-filter: blur(25px) saturate(200%);
                -webkit-backdrop-filter: blur(25px) saturate(200%);
                border-bottom: 1px solid rgba(0, 0, 0, 0.05);
                display: flex;
                justify-content: space-between;
                align-items: center;
            }

            header h1 {
                font-size: 22px;
                font-weight: 900;
                letter-spacing: -1px;
            }

            /* æ•¸æ“šå„€éŒ¶ç›¤ï¼šæ‡¸æµ®å¡ç‰‡ */
            .stats-grid {
                display: grid;
                grid-template-columns: repeat(3, 1fr);
                gap: 12px;
                padding: 20px;
            }
            .stat-card {
                background: white;
                padding: 20px 10px;
                border-radius: 24px;
                box-shadow: 0 10px 25px oklch(0% 0 0 / 4%);
                border: 1px solid rgba(0, 0, 0, 0.02);
                text-align: center;
                transition: transform 0.3s var(--spring);
            }
            .stat-card:active {
                transform: scale(0.95);
            }
            .stat-val {
                font-size: 24px;
                font-weight: 900;
                color: var(--primary);
            }
            .stat-label {
                font-size: 11px;
                color: var(--text-muted);
                font-weight: 800;
                margin-top: 4px;
            }

            /* åˆ†é åˆ‡æ›ï¼šiOS 18 è† å›Šé¢¨æ ¼ */
            .nav-tabs {
                display: flex;
                background: rgba(0, 0, 0, 0.05);
                margin: 0 20px 24px;
                padding: 5px;
                border-radius: 20px;
            }
            .nav-tab {
                flex: 1;
                padding: 12px;
                border: none;
                background: transparent;
                font-size: 15px;
                font-weight: 800;
                border-radius: 16px;
                transition: 0.4s var(--spring);
                color: var(--text-muted);
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 8px;
            }
            .nav-tab.active {
                background: white;
                color: var(--text-main);
                box-shadow: 0 8px 15px oklch(0% 0 0 / 8%);
            }

            /* ä»»å‹™å¡ç‰‡ï¼šæ·±åº¦è³ªæ„Ÿ */
            .card {
                background: white;
                border-radius: 32px;
                padding: 24px;
                margin: 0 20px 20px;
                box-shadow: var(--shadow-premium);
                border: 1px solid rgba(0, 0, 0, 0.03);
                animation: cardEntrance 0.6s var(--spring) backwards;
            }
            @keyframes cardEntrance {
                from {
                    opacity: 0;
                    transform: translateY(30px) scale(0.95);
                }
            }

            .prop-name {
                font-size: 20px;
                font-weight: 900;
                margin-bottom: 4px;
            }
            .price {
                font-size: 24px;
                font-weight: 900;
                color: var(--accent-gold);
            }

            .info-row {
                font-size: 14px;
                font-weight: 600;
                color: #555;
                margin-top: 10px;
                display: flex;
                align-items: center;
                gap: 8px;
            }

            .btn-grab {
                width: 100%;
                margin-top: 24px;
                padding: 20px;
                border-radius: 20px;
                background: var(--midnight);
                color: white;
                border: none;
                font-weight: 900;
                font-size: 17px;
                cursor: pointer;
                box-shadow: 0 15px 30px oklch(0% 0 0 / 25%);
                transition: 0.3s;
            }
            .btn-grab:active {
                transform: scale(0.96);
                background: var(--primary);
            }

            /* --- ã€å®Œç¾é‡æ§‹ã€‘å·¦ä¸‹è§’ FAB ç³»çµ± --- */
            .fab-container {
                position: fixed;
                bottom: 30px;
                left: 25px; /* åš´æ ¼å›ºå®šåœ¨å·¦ä¸‹è§’ */
                display: flex;
                flex-direction: column-reverse; /* é—œéµï¼šè®“å­é¸å–®å¾€æŒ‰éˆ•ä¸Šæ–¹é•· */
                align-items: flex-start;
                gap: 12px;
                z-index: 9999;
            }

            /* ä¸»æŒ‰éˆ• */
            .fab-main {
                width: 65px;
                height: 65px;
                border-radius: 22px;
                background: var(--midnight);
                color: white;
                border: none;
                display: flex;
                justify-content: center;
                align-items: center;
                box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
                cursor: pointer;
                transition: all 0.5s var(--spring);
            }
            .plus-icon {
                font-size: 32px;
                transition: transform 0.5s var(--spring);
            }

            /* å­é¸å–®åˆ—è¡¨ */
            .fab-options {
                display: flex;
                flex-direction: column-reverse;
                gap: 10px;
                pointer-events: none;
            }

            /* å­é¸å–®é …ï¼šé«˜äº®åº¦æ¯›ç»ç’ƒ + æ¥µé»‘ç²—é«”å­— */
            .fab-item {
                height: 54px;
                min-width: 160px;
                padding: 0 20px;
                border-radius: 18px;
                background: var(--glass-white);
                backdrop-filter: blur(20px) saturate(200%);
                -webkit-backdrop-filter: blur(20px) saturate(200%);

                /* æ–‡å­—æ¸…æ™°åº¦å„ªåŒ– */
                color: #000000 !important;
                font-size: 16px;
                font-weight: 900; /* æ¥µç²—é«” */
                letter-spacing: 0.5px;

                border: 1px solid var(--glass-border);
                box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
                display: flex;
                align-items: center;
                gap: 12px;

                opacity: 0;
                transform: translateY(20px) scale(0.8) rotate(-5deg);
                transition: all 0.4s var(--spring);
            }

            /* æ¿€æ´»ç‹€æ…‹ */
            .fab-container.active .fab-options {
                pointer-events: auto;
            }
            .fab-container.active .fab-item {
                opacity: 1;
                transform: translateY(0) scale(1) rotate(0);
            }
            .fab-container.active .plus-icon {
                transform: rotate(135deg);
            }
            .fab-container.active .fab-main {
                background: var(--primary);
                transform: scale(0.9);
            }

            /* å‹•æ…‹å»¶é² */
            .fab-item:nth-child(1) {
                transition-delay: 0s;
            }
            .fab-item:nth-child(2) {
                transition-delay: 0.05s;
            }
            .fab-item:nth-child(3) {
                transition-delay: 0.1s;
            }

            /* åå¸æç¤º */
            .toast {
                position: fixed;
                bottom: 50px;
                left: 50%;
                transform: translateX(-50%) translateY(100px);
                background: rgba(0, 0, 0, 0.85);
                color: white;
                padding: 14px 28px;
                border-radius: 50px;
                font-weight: 800;
                transition: 0.5s var(--spring);
                z-index: 10000;
            }
            .toast.show {
                transform: translateX(-50%) translateY(0);
            }
            /* --- 2026 æ——è‰¦è¦–è¦ºç³»çµ±ï¼šæ¥µè‡´æ¯›ç»ç’ƒèˆ‡ç‰©ç†å‹•æ•ˆ --- */
            :root {
                --primary: oklch(60% 0.18 255);
                --midnight: oklch(18% 0.02 250);
                --bg-canvas: oklch(98.5% 0.005 240);
                --text-main: #000000;
                --text-muted: oklch(45% 0.02 240);
                --accent-gold: oklch(70% 0.12 85);
                --glass-white: rgba(255, 255, 255, 0.85);
                --glass-border: rgba(255, 255, 255, 0.6);
                --shadow-lux: 0 20px 40px -10px rgba(0, 0, 0, 0.08);
                --spring: cubic-bezier(0.34, 1.56, 0.64, 1);
            }

            body {
                background: var(--bg-canvas);
                font-family:
                    "Inter",
                    -apple-system,
                    system-ui,
                    sans-serif;
                color: var(--text-main);
                padding-bottom: calc(100px + env(safe-area-inset-bottom));
                background-image:
                    radial-gradient(
                        circle at 0% 0%,
                        oklch(85% 0.08 250 / 15%),
                        transparent 40%
                    ),
                    radial-gradient(
                        circle at 100% 100%,
                        oklch(85% 0.12 320 / 12%),
                        transparent 40%
                    );
                background-attachment: fixed;
                margin: 0;
                -webkit-font-smoothing: antialiased;
            }

            /* --- 1. é ‚éƒ¨èˆ‡åˆ†é  (iOS 18 é¢¨æ ¼) --- */
            header {
                position: sticky;
                top: 0;
                z-index: 1000;
                padding: calc(env(safe-area-inset-top) + 16px) 20px 16px;
                background: rgba(255, 255, 255, 0.7);
                backdrop-filter: blur(25px) saturate(200%);
                -webkit-backdrop-filter: blur(25px) saturate(200%);
                border-bottom: 0.5px solid rgba(0, 0, 0, 0.1);
            }

            .nav-tabs {
                display: flex;
                background: rgba(0, 0, 0, 0.05);
                margin: 0 20px 20px;
                padding: 4px;
                border-radius: 20px;
            }
            .nav-tab {
                flex: 1;
                padding: 12px;
                border: none;
                background: transparent;
                font-size: 15px;
                font-weight: 800;
                border-radius: 16px;
                color: var(--text-muted);
                transition: 0.4s var(--spring);
            }
            .nav-tab.active {
                background: white;
                color: var(--text-main);
                box-shadow: 0 8px 15px rgba(0, 0, 0, 0.05);
            }

            /* --- 2. ä¸‹æ‹‰æ¡†ç¾åŒ– (Select Box) --- */
            .sort-bar {
                display: flex;
                gap: 10px;
                padding: 0 20px 15px;
            }
            .sort-select {
                flex: 1;
                padding: 12px 16px;
                border-radius: 14px;
                background: var(--glass-white);
                border: 1px solid var(--glass-border);
                font-weight: 700;
                color: var(--text-main);
                font-size: 14px;
                appearance: none;
                box-shadow: 0 4px 10px rgba(0, 0, 0, 0.02);
            }

            /* --- 3. ä»»å‹™å¡ç‰‡èˆ‡å°èˆªé€£çµ --- */
            .card {
                background: white;
                border-radius: 32px;
                padding: 24px;
                margin: 0 20px 16px;
                box-shadow: var(--shadow-lux);
                border: 1px solid rgba(0, 0, 0, 0.02);
                animation: cardIn 0.5s var(--spring) both;
            }
            @keyframes cardIn {
                from {
                    opacity: 0;
                    transform: translateY(20px);
                }
            }

            .map-link {
                display: inline-flex;
                align-items: center;
                gap: 6px;
                margin-top: 15px;
                color: var(--ios-blue);
                text-decoration: none;
                font-weight: 800;
                font-size: 14px;
                padding: 10px 16px;
                background: oklch(95% 0.02 255);
                border-radius: 12px;
            }

            /* --- 4. æŒ‰éˆ•é«”ç³» (æ¶å–®/å®Œæˆ) --- */
            .btn-grab,
            .btn-done,
            .btn-arrived {
                width: 100%;
                margin-top: 20px;
                padding: 18px;
                border-radius: 20px;
                border: none;
                font-weight: 900;
                font-size: 17px;
                cursor: pointer;
            }
            
            .btn-arrived {
                background: linear-gradient(135deg, #FF9800, #F57C00);
                color: white;
                box-shadow: 0 4px 15px rgba(255, 152, 0, 0.4);
            }
            .btn-arrived:active {
                transform: scale(0.98);
            }
                transition: 0.3s var(--spring);
            }
            .btn-grab {
                background: var(--midnight);
                color: white;
                box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            }
            .btn-done {
                background: var(--primary);
                color: white;
                box-shadow: 0 10px 25px oklch(60% 0.18 255 / 30%);
            }
            .btn-grab:active,
            .btn-done:active {
                transform: scale(0.96);
                opacity: 0.9;
            }

            /* --- 5. å®Œå·¥ç…§ç‰‡å±•ç¤º --- */
            .photo-strip {
                display: flex;
                gap: 8px;
                overflow-x: auto;
                padding: 4px 0;
                margin-top: 12px;
            }
            .photo-strip img {
                width: 70px;
                height: 70px;
                border-radius: 14px;
                object-fit: cover;
                border: 2px solid white;
                box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            }

            /* --- 6. ä¸Šå‚³å®Œå·¥ç…§ç‰‡ Modal (æ·±åº¦ç¾åŒ–) --- */
            .photo-upload-modal {
                position: fixed;
                inset: 0;
                background: rgba(0, 0, 0, 0.4);
                backdrop-filter: blur(15px);
                z-index: 10001;
                display: none;
                align-items: center;
                justify-content: center;
                padding: 20px;
            }
            .photo-upload-modal.active {
                display: flex;
                animation: modalIn 0.4s var(--spring);
            }
            @keyframes modalIn {
                from {
                    opacity: 0;
                    scale: 0.9;
                }
            }

            .photo-upload-box {
                background: var(--glass-white);
                width: 100%;
                max-width: 400px;
                padding: 30px;
                border-radius: 35px;
                border: 1px solid var(--glass-border);
                box-shadow: 0 30px 60px rgba(0, 0, 0, 0.2);
            }

            .photo-grid {
                display: grid;
                grid-template-columns: repeat(3, 1fr);
                gap: 12px;
                margin: 20px 0;
            }
            .photo-slot {
                aspect-ratio: 1;
                border-radius: 18px;
                background: rgba(0, 0, 0, 0.05);
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 24px;
                color: var(--text-muted);
                border: 2px dashed rgba(0, 0, 0, 0.1);
                position: relative;
                overflow: hidden;
            }
            .photo-slot img {
                width: 100%;
                height: 100%;
                object-fit: cover;
            }
            .del-photo {
                position: absolute;
                top: 4px;
                right: 4px;
                width: 22px;
                height: 22px;
                background: rgba(255, 0, 0, 0.8);
                color: white;
                border: none;
                border-radius: 50%;
                font-size: 14px;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .photo-actions {
                display: grid;
                grid-template-columns: 2fr 1fr;
                gap: 10px;
                margin-top: 20px;
            }
            .btn-photo-submit {
                background: var(--midnight);
                color: white;
                padding: 15px;
                border-radius: 16px;
                border: none;
                font-weight: 800;
            }
            .btn-photo-cancel {
                background: rgba(0, 0, 0, 0.05);
                color: var(--text-main);
                padding: 15px;
                border-radius: 16px;
                border: none;
                font-weight: 700;
            }

            /* --- 7. å·¦ä¸‹è§’ FAB ç³»çµ± --- */
            .fab-container {
                position: fixed;
                bottom: 30px;
                left: 25px;
                display: flex;
                flex-direction: column-reverse;
                align-items: flex-start;
                gap: 12px;
                z-index: 9999;
            }
            .fab-main {
                width: 65px;
                height: 65px;
                border-radius: 22px;
                background: var(--midnight);
                color: white;
                border: none;
                box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
                transition: 0.5s var(--spring);
            }
            .fab-item {
                height: 54px;
                min-width: 160px;
                padding: 0 20px;
                border-radius: 18px;
                background: var(--glass-white);
                backdrop-filter: blur(20px) saturate(200%);
                color: #000000 !important;
                font-weight: 900;
                border: 1px solid var(--glass-border);
                box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
                display: flex;
                align-items: center;
                gap: 12px;
                opacity: 0;
                transform: translateY(20px) scale(0.8);
                transition: 0.4s var(--spring);
            }
            .fab-container.active .fab-item {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
            /* --- 2026 æ——è‰¦è¦–è¦ºç³»çµ±ï¼šæ·±åº¦ä¿®å¾©ç‰ˆ --- */
            :root {
                --primary: oklch(60% 0.18 255);
                --midnight: oklch(18% 0.02 250);
                --bg-canvas: #f8fafc;
                --glass-white: rgba(255, 255, 255, 0.9);
                --glass-border: rgba(255, 255, 255, 0.6);
                --spring: cubic-bezier(0.34, 1.56, 0.64, 1);
            }

            /* 1. è§£æ±ºæ•¸æ“šçœ‹æ¿éŒ¯ä½ */
            .stats-grid {
                display: grid;
                grid-template-columns: repeat(3, 1fr); /* åš´æ ¼ä¸‰åˆ—å‡åˆ† */
                gap: 12px;
                padding: 16px 20px;
                align-items: stretch; /* ç¢ºä¿å¡ç‰‡é«˜åº¦ä¸€è‡´ */
            }

            .stat-card {
                background: white;
                padding: 16px 8px;
                border-radius: 20px;
                text-align: center;
                box-shadow: 0 8px 20px rgba(0, 0, 0, 0.03);
                border: 1px solid rgba(0, 0, 0, 0.02);
                display: flex;
                flex-direction: column;
                justify-content: center;
            }

            .stat-val {
                font-size: 20px;
                font-weight: 900;
                color: var(--primary);
                line-height: 1.2;
            }

            .stat-label {
                font-size: 11px;
                color: #64748b;
                font-weight: 700;
                margin-top: 4px;
                white-space: nowrap; /* é˜²æ­¢æ¨™ç±¤æ›è¡Œå°è‡´éŒ¯ä½ */
            }

            /* 2. æˆ¿æ±èªéŸ³å‚™è¨»çµ„ä»¶æ¨£å¼ */
            .voice-player {
                background: oklch(96% 0.01 255);
                padding: 12px 16px;
                border-radius: 16px;
                margin: 15px 0;
                display: flex;
                align-items: center;
                gap: 12px;
                border: 1px solid rgba(0, 0, 0, 0.03);
            }

            .voice-btn {
                width: 36px;
                height: 36px;
                border-radius: 50%;
                border: none;
                background: var(--midnight);
                color: white;
                font-size: 14px;
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
                transition: 0.3s;
            }

            .voice-btn.playing {
                background: var(--primary);
                box-shadow: 0 0 15px var(--primary);
            }

            .voice-label {
                font-size: 13px;
                font-weight: 800;
                color: var(--midnight);
            }

            /* 3. åœ°åœ–å°èˆªé€£çµç¾åŒ– */
            .map-link {
                display: flex;
                align-items: center;
                gap: 8px;
                padding: 12px 18px;
                background: #eef2ff;
                color: #4338ca;
                text-decoration: none;
                border-radius: 14px;
                font-weight: 800;
                font-size: 14px;
                margin: 12px 0;
                width: fit-content;
            }

            /* 4. å®Œå·¥ç…§ç‰‡èˆ‡æŒ‰éˆ•ç´°ç¯€ */
            .photo-strip {
                display: flex;
                gap: 8px;
                overflow-x: auto;
                padding: 8px 0;
            }

            .photo-strip img {
                width: 64px;
                height: 64px;
                border-radius: 12px;
                object-fit: cover;
                border: 2px solid white;
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            }

            .btn-grab,
            .btn-done {
                width: 100%;
                padding: 18px;
                border-radius: 20px;
                border: none;
                font-weight: 900;
                font-size: 16px;
                cursor: pointer;
                transition: 0.3s var(--spring);
                margin-top: 10px;
            }

            .btn-grab {
                background: var(--midnight);
                color: white;
            }
            .btn-done {
                background: var(--primary);
                color: white;
            }

            /* 5. å·¦ä¸‹è§’ FAB (å›ºå®šå®šä½) */
            .fab-container {
                position: fixed;
                bottom: 30px;
                left: 25px;
                display: flex;
                flex-direction: column-reverse;
                align-items: flex-start;
                gap: 12px;
                z-index: 9999;
            }
            /* éš±è—åŸç”Ÿæ–‡ä»¶ä¸Šå‚³æŒ‰éˆ• */
            .photo-input {
                display: none;
            }

            /* ç¢ºä¿é»æ“Šåœ–ç‰‡æ¡†æ™‚èƒ½è§¸ç™¼ä¸Šå‚³ */
            .photo-slot {
                cursor: pointer;
                transition: all 0.2s ease;
            }

            .photo-slot:hover {
                background: rgba(0, 0, 0, 0.08);
                border-color: var(--primary);
            }
            /* --- 2026 é«˜ç´šç©ºç‹€æ…‹è¨­è¨ˆ --- */
            .empty-state {
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                padding: 60px 20px;
                margin: 40px 20px;
                background: rgba(255, 255, 255, 0.4);
                backdrop-filter: blur(10px);
                border: 1px dashed rgba(0, 0, 0, 0.1);
                border-radius: 32px;
                animation: fadeInSlide 0.8s var(--spring);
            }

            .empty-icon {
                font-size: 64px;
                margin-bottom: 16px;
                filter: drop-shadow(0 10px 20px rgba(0, 0, 0, 0.1));
                animation: float 3s ease-in-out infinite;
            }

            .empty-text {
                font-size: 18px;
                font-weight: 800;
                color: var(--text-main);
                letter-spacing: -0.5px;
            }

            .empty-subtext {
                font-size: 14px;
                color: var(--text-muted);
                margin-top: 8px;
                font-weight: 600;
            }

            /* æµ®å‹•å‹•ç•« */
            @keyframes float {
                0%,
                100% {
                    transform: translateY(0);
                }
                50% {
                    transform: translateY(-10px);
                }
            }

            @keyframes fadeInSlide {
                from {
                    opacity: 0;
                    transform: translateY(20px) scale(0.95);
                }
                to {
                    opacity: 1;
                    transform: translateY(0) scale(1);
                }
            }
        </style>
    </head>
    <body>
        <!-- åŠ è¼‰é®ç½© -->
        <div id="loadingOverlay" class="loading-overlay">
            <div class="loading-spinner"></div>
            <div class="loading-text">è¼‰å…¥ä¸­...</div>
        </div>

        <header>
            <div class="logo">
                æ¥å•å¤§å…<span style="color: var(--primary)">CP</span>
            </div>
            <button
                onclick="location.href = 'index.html'"
                style="
                    border: none;
                    background: none;
                    font-weight: 700;
                    opacity: 0.5;
                "
            >
                ç™»å‡ºç³»çµ±
            </button>
        </header>

        <div class="stats-grid">
            <div class="stat-card">
                <span class="stat-val" id="statPending">0</span>
                <span class="stat-label">å¾…è¾¦ä»»å‹™</span>
            </div>
            <div class="stat-card">
                <span class="stat-val" id="statTotal">0</span>
                <span class="stat-label">ç´¯è¨ˆä»»å‹™</span>
            </div>
            <div class="stat-card">
                <span class="stat-val" id="statIncome">$0</span>
                <span class="stat-label">æœ¬æœˆæ”¶å…¥</span>
            </div>
        </div>

        <nav class="nav-tabs">
            <button
                class="nav-tab active"
                id="navOpen"
                onclick="showPage('open')"
            >
                <span>ğŸ“¥</span>
                <span>æ¶å–®å¤§å»³</span>
            </button>
            <button class="nav-tab" id="navMy" onclick="showPage('my')">
                <span>ğŸ“‹</span>
                <span>æˆ‘çš„ä»»å‹™</span>
            </button>
        </nav>

        <div class="sort-bar" id="sortBar" style="display: none">
            <select
                class="sort-select"
                id="sortType"
                onchange="loadOpenOrders()"
            >
                <option value="price">ğŸ’° é‡‘é¡</option>
                <option value="time">ğŸ• æ™‚é–“</option>
            </select>
            <select
                class="sort-select"
                id="sortOrder"
                onchange="loadOpenOrders()"
            >
                <option value="desc">å¾é«˜åˆ°ä½ â†“</option>
                <option value="asc">å¾ä½åˆ°é«˜ â†‘</option>
            </select>
        </div>

        <main id="pageOpen">
            <div id="openOrdersList"></div>
        </main>

        <div class="sort-bar" id="myTaskBar" style="display: none">
            <select
                class="sort-select"
                id="myTaskFilter"
                onchange="loadMyOrders()"
            >
                <option value="all">ğŸ“‹ å…¨éƒ¨</option>
                <option value="accepted">ğŸ”„ é€²è¡Œä¸­</option>
                <option value="completed">âœ… å·²å®Œæˆ</option>
            </select>
        </div>

        <main id="pageMy" style="display: none">
            <div id="myOrdersList"></div>
        </main>

        <div class="toast" id="toast"></div>

        <!-- å®Œå·¥ä¸Šå‚³Modal -->
        <div class="photo-upload-modal" id="photoModal">
            <div class="photo-upload-box">
                <div class="photo-upload-title">ğŸ“¸ ä¸Šå‚³å®Œå·¥ç…§ç‰‡ï¼ˆæœ€å¤š5å¼µï¼‰</div>
                <div class="photo-grid" id="photoGrid"></div>
                <input
                    type="file"
                    class="photo-input"
                    id="photoInput"
                    accept="image/*"
                    multiple
                />
                <div class="photo-actions">
                    <button
                        class="btn-photo-submit"
                        onclick="submitCompletion()"
                    >
                        âœ… ç¢ºèªæäº¤
                    </button>
                    <button
                        class="btn-photo-cancel"
                        onclick="closePhotoModal()"
                    >
                        å–æ¶ˆ
                    </button>
                </div>
            </div>
        </div>

        <script>
            // XSS é˜²è­·å‡½æ•¸
            function escapeHtml(str) {
                if (!str) return '';
                return String(str)
                    .replace(/&/g, '&amp;')
                    .replace(/</g, '&lt;')
                    .replace(/>/g, '&gt;')
                    .replace(/"/g, '&quot;')
                    .replace(/'/g, '&#039;');
            }
            const e = escapeHtml;
            const API = "https://biggish-londyn-unconvolute.ngrok-free.dev/api";
            const cleanerId = parseInt(localStorage.getItem("cleaner_id"));
            const cleanerCode = localStorage.getItem("cleaner_code");

            function haptic() {
                if (navigator.vibrate) navigator.vibrate(20);
            }

            if (!cleanerId) {
                location.href = "index.html";
            }
            function logout() {
                localStorage.clear();
                location.href = "index.html";
            }

            function showPage(page) {
                haptic();
                document
                    .querySelectorAll(".nav-tab")
                    .forEach((t) => t.classList.remove("active"));
                document
                    .getElementById(
                        `nav${page.charAt(0).toUpperCase() + page.slice(1)}`,
                    )
                    .classList.add("active");
                document.getElementById("pageOpen").style.display =
                    page === "open" ? "block" : "none";
                document.getElementById("pageMy").style.display =
                    page === "my" ? "block" : "none";
                document.getElementById("sortBar").style.display =
                    page === "open" ? "flex" : "none";
                document.getElementById("myTaskBar").style.display =
                    page === "my" ? "flex" : "none";
                page === "open" ? loadOpenOrders() : loadMyOrders();
            }

            async function loadStats() {
                try {
                    const res = await fetch(API + "/orders");
                    const data = await res.json();
                    const orders = data.data || [];

                    // çµ±è¨ˆ - è½‰æ›ç‚ºæ•¸å­—æ¯”è¼ƒ
                    const myOrders = orders.filter(
                        (o) => Number(o.assigned_cleaner_id) === cleanerId,
                    );
                    const pending = myOrders.filter(
                        (o) => o.status === "accepted",
                    ).length;
                    const total = myOrders.length;
                    const earnings = myOrders
                        .filter((o) => o.status === "completed")
                        .reduce((sum, o) => sum + (o.price || 0), 0);

                    document.getElementById("statPending").textContent =
                        pending;
                    document.getElementById("statTotal").textContent = total;
                    document.getElementById("statIncome").textContent =
                        "$" + earnings;
                } catch (e) {
                    # console.error("Stats fail", e);
                }
            }

            // çµ±ä¸€æ™‚é–“æ ¼å¼åŒ–
            function formatTime(isoString) {
                if (!isoString) return "-";
                try {
                    const d = new Date(isoString);
                    const y = d.getFullYear();
                    const m = String(d.getMonth() + 1).padStart(2, '0');
                    const day = String(d.getDate()).padStart(2, '0');
                    const h = String(d.getHours()).padStart(2, '0');
                    const min = String(d.getMinutes()).padStart(2, '0');
                    return `${y}-${m}-${day} ${h}:${min}`;
                } catch(e) { return isoString; }
            }

            async function loadOpenOrders() {
                try {
                    showLoading();
                    const res = await fetch(API + "/orders");
                    const data = await res.json();
                    let orders = (data.data || []).filter(
                        (o) =>
                            o.status === "open" &&
                            o.assigned_cleaner_id === null,
                    );

                    // æ’åº
                    const sortType = document.getElementById("sortType").value;
                    const sortOrder =
                        document.getElementById("sortOrder").value;
                    orders.sort((a, b) => {
                        if (sortType === "price") {
                            const priceA = Number(a.price) || 0;
                            const priceB = Number(b.price) || 0;
                            return sortOrder === "desc"
                                ? priceB - priceA
                                : priceA - priceB;
                        } else {
                            // æ™‚é–“æ’åº - created_at
                            const timeA = a.created_at || "";
                            const timeB = b.created_at || "";
                            return sortOrder === "desc"
                                ? timeB.localeCompare(timeA)
                                : timeA.localeCompare(timeB);
                        }
                    });

                    const list = document.getElementById("openOrdersList");
                    if (orders.length === 0) {
                        list.innerHTML =
                            '<div class="empty-state"><span class="empty-icon">ğŸ“¥</span>ç›®å‰æ²’æœ‰æ–°ä»»å‹™</div>';
                        return;
                    }

                    list.innerHTML = orders
                        .map(
                            (o) => `
                <div class="card">
                    <div class="card-header">
                        <div class="prop-name">${e(o.property_name) || "æœªå‘½åæˆ¿æº"}</div>
                        <div class="price">$${o.price}</div>
                    </div>
                    <div class="info-row">ğŸ“ ${shortAddr(o)}</div>
                    <div class="info-row">ğŸ• é€€æˆ¿æ™‚é–“: ${formatTime(o.checkout_time)}</div>
                    ${
                        o.voice_url
                            ? `
                        <div class="voice-player">
                            <button class="voice-btn" onclick="playVoice(this, '${o.voice_url}')">â–¶</button>
                            <audio src="${o.voice_url}" preload="metadata"></audio>
                            <span style="font-size:12px;color:var(--text-muted);font-weight:600;">æˆ¿æ±èªéŸ³å‚™è¨»</span>
                        </div>
                    `
                            : ""
                    }
                    ${
                        o.text_notes
                            ? `
                        <div class="info-row" style="background:var(--bg-light);padding:10px;border-radius:8px;margin:8px 0;">
                            <span style="font-size:12px;color:var(--text-muted);">ğŸ“ å‚™è¨»ï¼š</span>
                            <div style="font-weight:600;margin-top:4px;">${e(o.text_notes)}</div>
                        </div>
                    `
                            : ""
                    }
                    <a href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(shortAddr(o))}" class="map-link" target="_blank">â†—ï¸ æŸ¥çœ‹å°èˆªåœ°åœ–</a>
                    <button class="btn-grab" onclick="acceptOrder(${o.id})">âœ‹ ç«‹å³æ¶å–®</button>
                </div>`,
                        )
                        .join("");
                    hideLoading();
                } catch (e) {
                    hideLoading();
                    showToast("è¼‰å…¥è¨‚å–®å¤±æ•—");
                }
            }

            async function loadMyOrders() {
                try {
                    showLoading();
                    const res = await fetch(API + "/orders");
                    const data = await res.json();
                    const filter =
                        document.getElementById("myTaskFilter").value;
                    let orders = (data.data || []).filter(
                        (o) =>
                            Number(o.assigned_cleaner_id) === cleanerId &&
                            o.status !== "open",
                    );

                    // éæ¿¾
                    if (filter !== "all") {
                        orders = orders.filter((o) => o.status === filter);
                    }

                    document.getElementById("myOrdersList").innerHTML =
                        orders
                            .reverse()
                            .map(
                                (o) => `
                    <div class="card">
                        <div class="card-header">
                            <div class="prop-name">${e(o.property_name)}</div>
                            <div class="price">$${o.price}</div>
                        </div>
                        <div class="info-row">ğŸ“ ${fullAddr(o)}</div>
                        <div class="info-row">ğŸ“± <a href="tel:${e(o.host_phone)}" style="color:var(--primary);text-decoration:none;">${e(o.host_phone)}</a> (æˆ¿æ±)</div>
                        <div class="info-row">ğŸ• ${formatTime(o.checkout_time)}</div>
                        ${
                            o.voice_url
                                ? `
                            <div class="voice-player">
                                <button class="voice-btn" onclick="playVoice(this, '${o.voice_url}')">â–¶</button>
                                <audio src="${o.voice_url}" preload="metadata"></audio>
                                <span style="font-size:12px;color:var(--text-muted);font-weight:600;">æˆ¿æ±èªéŸ³å‚™è¨»</span>
                            </div>
                        `
                                : ""
                        }
                        ${
                            o.text_notes
                                ? `
                            <div class="info-row" style="background:#E8F5E9;padding:12px;border-radius:10px;margin-top:10px;border-left:3px solid #4CAF50;">
                                <div style="font-size:12px;color:#2E7D32;font-weight:600;">ğŸ“ æ–‡å­—å‚™è¨»ï¼š</div>
                                <div style="font-weight:600;margin-top:6px;color:#333;">${e(o.text_notes)}</div>
                            </div>
                        `
                                : ""
                        }
                        <div class="info-row">ğŸ“Š ç‹€æ…‹: <span class="badge badge-${o.status}">${
                            o.status === "open" ? "å¾…æ¶å–®" :
                            o.status === "accepted" ? "å·²æ¥å–®" :
                            o.status === "arrived" ? "å·²åˆ°é”-æ¸…æ½”ä¸­" :
                            "å·²å®Œæˆ"
                        }</span></div>
                        ${o.status === "completed" ? renderCompletionPhotos(o.completion_photos) : ""}
                        <a href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(fullAddr(o))}" class="map-link" target="_blank">â†—ï¸ æŸ¥çœ‹åœ°åœ–å°èˆª</a>
                        ${o.status === "accepted" ? `<button class="btn-arrived" onclick="arrivedOrder(${o.id})">ğŸ“ æˆ‘å·²åˆ°é”</button>` : ""}
                        ${o.status === "arrived" ? `<button class="btn-done" onclick="completeOrder(${o.id})">âœ… æ¸…æ½”å®Œæˆ</button>` : ""}
                    </div>
                `,
                            )
                            .join("") ||
                        '<div class="empty-state">å°šç„¡ä»»å‹™ç´€éŒ„</div>';
                    hideLoading();
                } catch (e) {
                    hideLoading();
                    # console.error(e);
                }
            }

            async function acceptOrder(id) {
                // å…ˆç²å–è¨‚å–®è©³æƒ…ï¼Œå½ˆå‡ºç¢ºèªæ¡†
                try {
                    const res = await fetch(API + "/orders/" + id);
                    const data = await res.json();
                    const o = data.data;
                    
                    if (!o) {
                        showToast("è¨‚å–®ä¸å­˜åœ¨");
                        return;
                    }
                    
                    // å½ˆå‡ºç¢ºèªè¦–çª—
                    const modal = document.createElement('div');
                    modal.id = 'acceptConfirmModal';
                    modal.style.cssText = 'position:fixed;inset:0;background:rgba(0,0,0,0.5);z-index:9999;display:flex;align-items:center;justify-content:center;';
                    modal.innerHTML = `
                        <div style="background:white;border-radius:20px;padding:24px;max-width:90%;width:340px;box-shadow:0 20px 60px rgba(0,0,0,0.3);">
                            <h3 style="margin:0 0 16px 0;font-size:18px;color:var(--midnight);">ğŸ“‹ ç¢ºèªæ¥å–®</h3>
                            <div style="background:var(--bg-light);padding:16px;border-radius:12px;margin-bottom:16px;">
                                <div style="font-size:13px;color:var(--text-muted);margin-bottom:4px;">ğŸ“± è¯ç¹«é›»è©±</div>
                                <a href="tel:${e(o.host_phone)}" style="font-weight:700;font-size:18px;color:var(--primary);text-decoration:none;">${e(o.host_phone)}</a>
                            </div>
                            <div style="background:#FFF3E0;padding:12px;border-radius:12px;margin-bottom:20px;border-left:4px solid #FF9800;">
                                <div style="font-size:13px;color:#E65100;font-weight:600;">âš ï¸ æç¤º</div>
                                <div style="font-size:13px;color:#E65100;margin-top:4px;">è«‹å‹™å¿…è¯ç¹«æˆ¿æ±ç¢ºèªè©³æƒ…å¾Œå†å‰å¾€</div>
                            </div>
                            <div style="display:flex;gap:12px;">
                                <button onclick="closeAcceptModal()" style="flex:1;padding:14px;border-radius:12px;border:2px solid #ddd;background:white;color:#666;font-weight:700;cursor:pointer;">å–æ¶ˆ</button>
                                <button id="confirmAcceptBtn" style="flex:1;padding:14px;border-radius:12px;border:none;background:var(--primary);color:white;font-weight:700;cursor:pointer;">âœ… ç¢ºèªæ¥å–®</button>
                            </div>
                        </div>
                    `;
                    document.body.appendChild(modal);
                    
                    document.getElementById('confirmAcceptBtn').onclick = async () => {
                        modal.remove();
                        await doAcceptOrder(id);
                    };
                    
                } catch (e) {
                    showToast("ç²å–è¨‚å–®å¤±æ•—");
                }
            }
            
            function closeAcceptModal() {
                const modal = document.getElementById('acceptConfirmModal');
                if (modal) modal.remove();
            }
            
            async function doAcceptOrder(id) {
                haptic();
                showLoading("æ¥å–®ä¸­...");
                try {
                    const res = await fetch(API + "/orders/" + id, {
                        method: "PUT",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({
                            status: "accepted",
                            cleaner_id: cleanerId,
                        }),
                    });
                    const data = await res.json();
                    hideLoading();
                    if (res.ok) {
                        showToast("ğŸ‰ æ¶å–®æˆåŠŸï¼è«‹è¯ç¹«æˆ¿æ±");
                        setTimeout(() => {
                            window.location.reload();
                        }, 1500);
                    } else {
                        showToast(
                            "âŒ " + (data.message || "æ‰‹é€Ÿæ…¢äº†ï¼Œå·²è¢«æ¶èµ°"),
                        );
                    }
                } catch (e) {
                    hideLoading();
                    showToast("è«‹æ±‚å¤±æ•—");
                }
            }

            // åŠ è¼‰å‹•ç•«æ§åˆ¶
            function showLoading(text = "è¼‰å…¥ä¸­...") {
                const overlay = document.getElementById("loadingOverlay");
                const textEl = overlay.querySelector(".loading-text");
                textEl.textContent = text;
                overlay.classList.add("active");
                document.body.classList.add("no-scroll");
            }

            function hideLoading() {
                const overlay = document.getElementById("loadingOverlay");
                overlay.classList.remove("active");
                document.body.classList.remove("no-scroll");
            }

            function showToast(msg) {
                const t = document.getElementById("toast");
                t.textContent = msg;
                t.classList.add("show");
                setTimeout(() => t.classList.remove("show"), 3000);
            }

            // å®Œå·¥ç…§ç‰‡ä¸Šå‚³
            let currentOrderId = null;
            let uploadedPhotos = [];

            // æ¸…æ½”å·¥åˆ°é”ç¾å ´
            function arrivedOrder(id) {
                haptic();
                showLoading("è™•ç†ä¸­...");
                fetch(API + "/orders/" + id, {
                    method: "PUT",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ status: "arrived" })
                })
                .then(r => r.json())
                .then(d => {
                    hideLoading();
                    if (d.message || d.data) {
                        showToast("ğŸ“ å·²è¨˜éŒ„åˆ°é”ï¼Œé–‹å§‹æ¸…æ½”ï¼");
                        loadMyOrders();
                    } else {
                        showToast("âŒ æ“ä½œå¤±æ•—");
                    }
                })
                .catch(e => {
                    hideLoading();
                    showToast("âŒ è«‹æ±‚å¤±æ•—");
                });
            }

            function completeOrder(id) {
                # console.log("completeOrder called with id:", id);
                currentOrderId = id;
                uploadedPhotos = [];
                renderPhotoGrid();
                document.getElementById("photoModal").classList.add("active");
            }

            function closePhotoModal() {
                document
                    .getElementById("photoModal")
                    .classList.remove("active");
                currentOrderId = null;
                uploadedPhotos = [];
            }

            function renderPhotoGrid() {
                const grid = document.getElementById("photoGrid");
                let html = "";
                for (let i = 0; i < 5; i++) {
                    if (uploadedPhotos[i]) {
                        html += `<div class="photo-slot has-photo">
                        <img src="${uploadedPhotos[i]}">
                        <button class="del-photo" onclick="deletePhoto(${i})">Ã—</button>
                    </div>`;
                    } else {
                        html += `<div class="photo-slot" onclick="triggerPhotoUpload(${i})">+</div>`;
                    }
                }
                grid.innerHTML = html;
            }

            function triggerPhotoUpload(index) {
                const input = document.getElementById("photoInput");
                input.onchange = (e) => {
                    const file = e.target.files[0];
                    if (file) {
                        compressImage(file, 800, 0.7, (base64) => {
                            uploadedPhotos[index] = base64;
                            renderPhotoGrid();
                        });
                    }
                    input.value = "";
                };
                input.click();
            }

            // åœ–ç‰‡å£“ç¸®å‡½æ•¸
            function compressImage(file, maxWidth, quality, callback) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = new Image();
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        let width = img.width;
                        let height = img.height;
                        // èª¿æ•´å°ºå¯¸
                        if (width > maxWidth) {
                            height = (height * maxWidth) / width;
                            width = maxWidth;
                        }
                        canvas.width = width;
                        canvas.height = height;
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0, width, height);
                        // è¼¸å‡ºå£“ç¸®å¾Œçš„ base64
                        callback(canvas.toDataURL('image/jpeg', quality));
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            }

            function deletePhoto(index) {
                uploadedPhotos.splice(index, 1);
                renderPhotoGrid();
            }

            async function submitCompletion() {
                const orderId = currentOrderId;
                # console.log(
                    "submitCompletion called, currentOrderId:",
                    orderId,
                );
                if (!orderId) {
                    showToast("è¨‚å–®IDç„¡æ•ˆï¼Œè«‹é‡è©¦");
                    return;
                }
                // Save photos BEFORE closing modal
                const validPhotos = uploadedPhotos.filter(
                    (p) => p && p.length > 0,
                );
                # console.log("Valid photos:", validPhotos.length);

                // Close modal
                document
                    .getElementById("photoModal")
                    .classList.remove("active");

                # console.log(
                    "Submitting completion, orderId:",
                    orderId,
                    "photos:",
                    validPhotos.length,
                );
                showToast("æ­£åœ¨æäº¤...");
                try {
                    const bodyData = {
                        status: "completed",
                        cleaner_id: parseInt(cleanerId),
                        completion_photos: JSON.stringify(validPhotos),
                    };
                    const res = await fetch(`${API}/orders/${orderId}`, {
                        method: "PUT",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify(bodyData),
                    });
                    if (res.ok) {
                        showToast("âœ… ä»»å‹™å·²å®Œæˆï¼");
                        loadMyOrders();
                        loadStats();
                    } else {
                        showToast("æäº¤å¤±æ•—");
                    }
                } catch (e) {
                    showToast("æäº¤å¤±æ•—");
                }
            }

            function playVoice(btn, url) {
                const audio = btn.parentElement.querySelector("audio");
                if (audio.paused) {
                    audio.play();
                    btn.textContent = "â¸";
                    btn.classList.add("playing");
                    audio.onended = () => {
                        btn.textContent = "â–¶";
                        btn.classList.remove("playing");
                    };
                } else {
                    audio.pause();
                    audio.currentTime = 0;
                    btn.textContent = "â–¶";
                    btn.classList.remove("playing");
                }
            }

            // éš±è—é–€ç‰Œè™Ÿ - åªé¡¯ç¤ºè¡—é“ã€åŸå¸‚ã€çœ
            function shortAddr(item) {
                // è¨‚å–®å°è±¡
                if (
                    item.property_province !== undefined ||
                    item.property_city !== undefined
                ) {
                    const parts = [];
                    if (item.property_street) parts.push(item.property_street);
                    if (item.property_city) parts.push(item.property_city);
                    if (item.property_province)
                        parts.push(item.property_province);
                    if (parts.length > 0) return parts.join(", ");
                    // æ²’æœ‰æ‹†åˆ†å­—æ®µæ™‚ä½¿ç”¨åŸåœ°å€
                    if (item.property_address) return item.property_address;
                }
                return "ç„¡åœ°å€";
            }

            // å®Œæ•´åœ°å€ - ç”¨æ–¼å°èˆª
            function fullAddr(item) {
                if (
                    item.property_province ||
                    item.property_city ||
                    item.property_street
                ) {
                    const parts = [];
                    if (item.property_house_number)
                        parts.push(item.property_house_number);
                    if (item.property_street) parts.push(item.property_street);
                    if (item.property_city) parts.push(item.property_city);
                    if (item.property_province)
                        parts.push(item.property_province);
                    return parts.join(", ");
                }
                return item.property_address || item.address || "ç„¡åœ°å€";
            }

            function renderCompletionPhotos(photosJson) {
                try {
                    let photos =
                        typeof photosJson === "string"
                            ? JSON.parse(photosJson)
                            : photosJson;
                    if (!photos || !Array.isArray(photos)) photos = [];
                    photos = photos.filter((p) => p && p.length > 0); // Filter empty
                    if (photos.length === 0) return "";
                    return `<div style="margin-top:12px;">
                    <div style="font-size:12px;color:var(--text-muted);font-weight:700;margin-bottom:8px;">ğŸ“¸ å®Œå·¥ç…§ç‰‡</div>
                    <div style="display:flex;gap:6px;overflow-x:auto;padding-bottom:4px;">
                        ${photos.map((p) => `<img src="${p}" style="width:60px;height:60px;border-radius:8px;object-fit:cover;flex-shrink:0;cursor:pointer;" onclick="viewPhoto('${p}')">`).join("")}
                    </div>
                </div>`;
                } catch (e) {
                    return "";
                }
            }

            function viewPhoto(url) {
                window.open(url, "_blank");
            }

            loadStats();
            loadOpenOrders();
            setInterval(() => {
                if (
                    document.getElementById("pageOpen").style.display !== "none"
                )
                    loadOpenOrders();
            }, 20000);
        </script>
    </body>
</html>
