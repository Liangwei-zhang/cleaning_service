<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“Š çŸ­ç§Ÿæ¸…æ½” - ç®¡ç†å“¡</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #f5f5f5; }
        header { background: #8A9A5B; padding: 15px 20px; color: white; display: flex; justify-content: space-between; align-items: center; }
        h1 { font-size: 18px; }
        .logout { background: rgba(255,255,255,0.2); border: none; color: white; padding: 8px 15px; border-radius: 5px; cursor: pointer; }
        
        .stats { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; padding: 15px; background: white; }
        .stat { text-align: center; padding: 15px; background: #f8f8f8; border-radius: 8px; }
        .stat-num { font-size: 24px; font-weight: bold; color: #8A9A5B; }
        .stat-label { font-size: 12px; color: #666; }
        
        .tabs { display: flex; gap: 10px; padding: 15px; background: white; }
        .tab { flex: 1; padding: 12px; border: none; border-radius: 10px 10px 0 0; cursor: pointer; font-size: 14px; }
        .tab.active { background: #8A9A5B; color: white; }
        .tab.inactive { background: #ddd; color: #333; }
        
        .content { padding: 15px; }
        .btn { background: #8A9A5B; color: white; border: none; padding: 10px 15px; border-radius: 8px; cursor: pointer; font-size: 14px; margin-bottom: 10px; }
        .btn-danger { background: #f44336; }
        
        .card { background: white; padding: 15px; border-radius: 10px; margin-bottom: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .card-title { font-weight: bold; font-size: 16px; }
        .card-info { color: #666; font-size: 13px; margin-top: 5px; }
    </style>
</head>
<body>
    <header>
        <h1>ğŸ“Š çŸ­ç§Ÿæ¸…æ½” - ç®¡ç†å“¡</h1>
        <button class="logout" onclick="logout()">ç™»å‡º</button>
    </header>
    
    <div class="stats">
        <div class="stat"><div class="stat-num" id="statProperties">0</div><div class="stat-label">æˆ¿æº</div></div>
        <div class="stat"><div class="stat-num" id="statCleaners">0</div><div class="stat-label">æ¸…æ½”å·¥</div></div>
        <div class="stat"><div class="stat-num" id="statHosts">0</div><div class="stat-label">æˆ¿æ±</div></div>
        <div class="stat"><div class="stat-num" id="statOrders">0</div><div class="stat-label">è¨‚å–®</div></div>
    </div>
    
    <div class="tabs">
        <button class="tab active" id="tabCleaners" onclick="switchTab('cleaners')">ğŸ‘· æ¸…æ½”å·¥</button>
        <button class="tab inactive" id="tabHosts" onclick="switchTab('hosts')">ğŸ  æˆ¿æ±</button>
        <button class="tab inactive" id="tabOrders" onclick="switchTab('orders')">ğŸ“‹ è¨‚å–®</button>
    </div>
    
    <div id="cleanersPanel" class="content">
        <button class="btn" onclick="showAddCleaner()">â• æ·»åŠ æ¸…æ½”å·¥</button>
        <div id="cleanersList"></div>
    </div>
    
    <div id="hostsPanel" class="content" style="display:none">
        <button class="btn" onclick="showAddHost()">â• æ·»åŠ æˆ¿æ±</button>
        <div id="hostsList"></div>
    </div>
    
    <div id="ordersPanel" class="content" style="display:none">
        <div id="ordersList"></div>
    </div>
    
    <script>
        const API = 'http://127.0.0.1:5000/api';
        
        function logout() {
            localStorage.clear();
            location.href = 'index.html';
        }
        
        function switchTab(tab) {
            ['cleaners', 'hosts', 'orders'].forEach(t => {
                document.getElementById('tab' + t.charAt(0).toUpperCase() + t.slice(1)).className = 
                    tab === t ? 'tab active' : 'tab inactive';
                document.getElementById(t + 'Panel').style.display = tab === t ? 'block' : 'none';
            });
        }
        
        async function loadStats() {
            const [stats, cleaners, hosts, orders] = await Promise.all([
                fetch(API + '/stats').then(r => r.json()),
                fetch(API + '/cleaners').then(r => r.json()),
                fetch(API + '/hosts').then(r => r.json()),
                fetch(API + '/orders').then(r => r.json())
            ]);
            
            document.getElementById('statProperties').textContent = stats.properties;
            document.getElementById('statCleaners').textContent = stats.available_cleaners;
            document.getElementById('statHosts').textContent = hosts.data.length;
            document.getElementById('statOrders').textContent = orders.data.length;
            
            document.getElementById('cleanersList').innerHTML = cleaners.data.slice(0, 20).map(c => `
                <div class="card">
                    <div class="card-title">${c.name}</div>
                    <div class="card-info">ğŸ“ ${c.phone} | â­ ${c.rating} | ç¸½è¨‚å–®: ${c.total_jobs}</div>
                    <button class="btn btn-danger" onclick="deleteCleaner(${c.id})">åˆªé™¤</button>
                </div>
            `).join('');
            
            document.getElementById('hostsList').innerHTML = hosts.data.slice(0, 20).map(h => `
                <div class="card">
                    <div class="card-title">${h.name}</div>
                    <div class="card-info">ğŸ“ ${h.phone} | Code: ${h.code}</div>
                    <button class="btn btn-danger" onclick="deleteHost(${h.id})">åˆªé™¤</button>
                </div>
            `).join('');
            
            document.getElementById('ordersList').innerHTML = orders.data.slice(0, 20).map(o => `
                <div class="card">
                    <div class="card-title">${o.property_name || 'æœªçŸ¥'} - $${o.price}</div>
                    <div class="card-info">${o.host_name} | ${o.checkout_time} | ${o.status}</div>
                </div>
            `).join('');
        }
        
        async function deleteCleaner(id) {
            if (confirm('ç¢ºå®šåˆªé™¤?')) {
                await fetch(API + '/cleaners/' + id, { method: 'DELETE' });
                loadStats();
            }
        }
        
        async function deleteHost(id) {
            if (confirm('ç¢ºå®šåˆªé™¤?')) {
                await fetch(API + '/hosts/' + id, { method: 'DELETE' });
                loadStats();
            }
        }
        
        function showAddCleaner() {
            const name = prompt('å§“å:');
            const phone = prompt('é›»è©±:');
            if (name && phone) {
                fetch(API + '/cleaners/register', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, phone })
                }).then(() => loadStats());
            }
        }
        
        function showAddHost() {
            const name = prompt('å§“å:');
            const phone = prompt('é›»è©±:');
            if (name && phone) {
                fetch(API + '/hosts', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, phone })
                }).then(() => loadStats());
            }
        }
        
        loadStats();
    </script>
</body>
</html>
