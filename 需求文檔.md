# 短租清潔管理系統 - 需求文檔

## 項目概述

**項目名稱：** 短租清潔管理系統 (Airbnb/Rental Cleaning Management)
**項目位置：** `/home/nico/projects/cleaning_service/`
**訪問地址：** `http://127.0.0.1:5000`

---

## 角色與權限

### 1. 房東 (Host)
- **房源管理**：增刪改查自己的房源
- **發布訂單**：發布清潔訂單
- **訂單管理**：查看自己發布的訂單狀態
- **登錄方式**：電話號碼 + 6位驗證碼

### 2. 清潔工 (Cleaner)
- **接單**：搶接開放的清潔訂單
- **完成訂單**：完成清潔後標記完成
- **登錄方式**：6位驗證碼

### 3. 管理員 (Admin)
- **房源管理**：查看所有房源
- **清潔工管理**：增刪改查清潔工
- **房東管理**：增刪改查房東
- **訂單管理**：查看所有訂單、取消訂單

---

## 功能模塊

### 1. 首頁 / 登錄頁
- 角色選擇：房東 / 清潔工 / 管理員
- 房東登錄（電話號碼驗證）
- 清潔工登錄（6位驗證碼）

### 2. 房東功能（左右布局）

**左側：我的訂單**
- 📋 訂單列表（自己發布的）
- ➕ 發布新訂單
- 訂單狀態：待接單 / 已接單 / 已完成

**右側：我的房源**
- 🏡 房源列表
- ➕ 添加房源
- ✏️ 編輯房源
- 🗑️ 刪除房源

**房源字段：**
- 名稱 (name)
- 地址 (address)
- 臥室數 (bedrooms)
- 衛浴數 (bathrooms)
- 清潔時長 (cleaning_time_minutes)
- 清潔清單 (cleaning_checklist)
- 備註 (notes)

### 3. 清潔工功能

- 📋 搶單大廳：查看所有開放訂單
- 👷 接單：選擇訂單輸入驗證碼確認接單
- ✅ 完成：完成清潔後標記完成

### 4. 管理員功能

- 📊 儀表板：統計數據
- 👷 清潔工管理：增刪改查
- 🏠 房東管理：增刪改查
- 📋 訂單管理：查看所有 / 取消

---

## API 接口

### 房源
| 方法 | 路徑 | 說明 |
|------|------|------|
| GET | `/api/properties` | 獲取房源列表 |
| POST | `/api/properties` | 添加房源 |
| PUT | `/api/properties/{id}` | 更新房源 |
| DELETE | `/api/properties/{id}` | 刪除房源 |

### 清潔工
| 方法 | 路徑 | 說明 |
|------|------|------|
| GET | `/api/cleaners` | 獲取清潔工列表 |
| POST | `/api/cleaners/register` | 註冊清潔工 |
| DELETE | `/api/cleaners/{id}` | 刪除清潔工 |

### 房東
| 方法 | 路徑 | 說明 |
|------|------|------|
| GET | `/api/hosts` | 獲取房東列表 |
| POST | `/api/hosts` | 添加房東 |
| POST | `/api/hosts/login` | 房東登錄/註冊 |
| PUT | `/api/hosts/{id}` | 更新房東 |
| DELETE | `/api/hosts/{id}` | 刪除房東 |

### 訂單
| 方法 | 路徑 | 說明 |
|------|------|------|
| GET | `/api/orders` | 獲取訂單列表 |
| POST | `/api/orders` | 發布訂單 |
| POST | `/api/orders/{id}/verify-accept` | 清潔工驗證接單 |
| POST | `/api/orders/{id}?action=complete` | 完成訂單 |
| DELETE | `/api/orders/{id}` | 刪除訂單 |

### 統計
| 方法 | 路徑 | 說明 |
|------|------|------|
| GET | `/api/stats` | 獲取統計數據 |

---

## 數據庫結構

### properties（房源表）
```sql
CREATE TABLE properties (
    id INTEGER PRIMARY KEY,
    name TEXT,
    address TEXT,
    bedrooms INTEGER DEFAULT 1,
    bathrooms INTEGER DEFAULT 1,
    cleaning_time_minutes INTEGER DEFAULT 120,
    cleaning_checklist TEXT,
    notes TEXT,
    status VARCHAR(20) DEFAULT 'active',
    created_at TIMESTAMP
);
```

### cleaners（清潔工表）
```sql
CREATE TABLE cleaners (
    id INTEGER PRIMARY KEY,
    name TEXT,
    phone TEXT,
    email TEXT,
    status VARCHAR(20) DEFAULT 'available',
    rating REAL DEFAULT 5.0,
    total_jobs INTEGER DEFAULT 0,
    code TEXT,
    created_at TIMESTAMP
);
```

### hosts（房東表）
```sql
CREATE TABLE hosts (
    id INTEGER PRIMARY KEY,
    name TEXT,
    phone TEXT,
    code TEXT,
    created_at TIMESTAMP
);
```

### orders（訂單表）
```sql
CREATE TABLE orders (
    id INTEGER PRIMARY KEY,
    property_id INTEGER,
    host_name TEXT,
    host_phone TEXT,
    checkout_time TEXT,
    price REAL,
    status VARCHAR(20) DEFAULT 'open',
    assigned_cleaner_id INTEGER,
    assigned_at TEXT,
    created_at TIMESTAMP
);
```

---

## 技術棧

- **後端**：Python HTTP Server (BaseHTTP)
- **數據庫**：SQLite
- **前端**：HTML + CSS + JavaScript
- **部署**：本地服務器

---

## 當前數據

- 房源：5 個
- 清潔工：507 個
- 房東：4+ 個
- 訂單：102 個

---

## 啟動命令

```bash
cd /home/nico/projects/cleaning_service
python3 api/server.py
```

訪問：`http://127.0.0.1:5000`

---

## 待優化功能

1. [ ] 訂單狀態實時更新
2. [ ] 推送通知（清潔工新訂單提醒）
3. [ ] 訂單完成後房東確認
4. [ ] 清潔工評分系統
5. [ ] 財務統計（收入報表）
6. [ ] 日曆視圖（訂單排期）
